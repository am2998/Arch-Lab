# Maintainer: Andrea Moscato <am2998@github.com>
pkgname=zfs-manager
pkgver=1.0.0
pkgrel=1
pkgdesc="A GTK GUI application for managing ZFS snapshots on Arch Linux"
arch=('any')
url="https://github.com/am2998/Arch-Lab"
license=('MIT')
depends=('python>=3.6' 'gtk4' 'libadwaita' 'python-gobject' 'python-cairo' 'zfs-dkms' 'zfs-utils')
makedepends=('python-setuptools' 'python-build' 'python-installer' 'python-wheel')
optdepends=('python-notify2: For desktop notifications')
source=("git+$url.git")
sha256sums=('SKIP')

build() {
  cd "$srcdir/Arch-Lab/zfs-manager"
}

package() {
  cd "$srcdir/Arch-Lab/zfs-manager"
  
  # Create required directories
  install -dm755 "$pkgdir/usr/lib/python3.11/site-packages/zfs_manager"
  install -dm755 "$pkgdir/usr/bin"
  install -dm755 "$pkgdir/usr/share/applications"
  install -dm755 "$pkgdir/usr/share/icons/hicolor/scalable/apps"
  install -dm755 "$pkgdir/usr/share/licenses/$pkgname"
  
  # Install Python package files
  for file in src/*.py; do
    install -m644 "$file" "$pkgdir/usr/lib/python3.11/site-packages/zfs_manager/"
  done
  
  # Install license
  install -m644 "$srcdir/Arch-Lab/LICENSE" "$pkgdir/usr/share/licenses/$pkgname/"
  
  # Create launcher script
  cat > "$pkgdir/usr/bin/zfs-manager" << EOF
#!/bin/sh
exec python -m zfs_manager.src.zfs_manager
EOF
  chmod 755 "$pkgdir/usr/bin/zfs-manager"
  
  # Create desktop entry
  cat > "$pkgdir/usr/share/applications/zfs-manager.desktop" << EOF
[Desktop Entry]
Name=ZFS Snapshot Manager
Comment=Manage ZFS snapshots on Arch Linux
Exec=zfs-manager
Icon=zfs-manager
Terminal=false
Type=Application
Categories=System;
Keywords=ZFS;Snapshot;Manager;
EOF

  # Create a simple SVG icon if none exists
  # This is a placeholder - you should replace with a proper icon
  if [ ! -f "$pkgdir/usr/share/icons/hicolor/scalable/apps/zfs-manager.svg" ]; then
    cat > "$pkgdir/usr/share/icons/hicolor/scalable/apps/zfs-manager.svg" << EOF
<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48">
  <rect width="40" height="40" x="4" y="4" fill="#3584e4" rx="8" />
  <text x="24" y="29" font-family="Sans" font-size="16" text-anchor="middle" fill="white">ZFS</text>
</svg>
EOF
  fi
}